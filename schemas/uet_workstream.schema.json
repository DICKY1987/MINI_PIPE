{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "UET Workstream Specification V1",
  "description": "Schema for UET-compatible workstream definitions",
  "version": "1.0.0",
  "type": "object",
  "required": ["ws_id", "name", "description", "tasks"],
  "properties": {
    "ws_id": {
      "type": "string",
      "pattern": "^ws-[a-z0-9-]+$",
      "description": "Unique workstream identifier"
    },
    "name": {
      "type": "string",
      "minLength": 5,
      "maxLength": 200,
      "description": "Human-readable workstream name"
    },
    "description": {
      "type": "string",
      "minLength": 10,
      "maxLength": 1000,
      "description": "Workstream description"
    },
    "tasks": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/task"
      },
      "description": "List of tasks in this workstream"
    },
    "parallelism": {
      "type": "integer",
      "minimum": 1,
      "default": 1,
      "description": "Maximum number of tasks to run in parallel"
    },
    "workspace_ref": {
      "oneOf": [
        {"type": "null"},
        {"$ref": "#/definitions/workspace_ref"}
      ],
      "description": "Git workspace reference"
    },
    "gap_ids": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Source gap IDs that generated this workstream"
    },
    "priority_score": {
      "type": "number",
      "minimum": 0,
      "maximum": 10,
      "default": 0,
      "description": "Priority score (0-10, higher is more urgent)"
    },
    "dependencies": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Other ws_ids that must complete first"
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 UTC timestamp of creation"
    }
  },
  
  "definitions": {
    "task": {
      "type": "object",
      "required": ["task_id", "pattern_id", "operation_kind"],
      "properties": {
        "task_id": {
          "type": "string",
          "pattern": "^[a-z0-9-]+$",
          "description": "Unique task identifier within workstream"
        },
        "pattern_id": {
          "type": "string",
          "description": "Reference to pattern in PATTERN_INDEX.yaml"
        },
        "operation_kind": {
          "type": "string",
          "pattern": "^EXEC-[A-Z0-9-]+$",
          "description": "Operation type (e.g., EXEC-AIDER-EDIT, EXEC-PYTEST)"
        },
        "file_scope": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Files this task operates on"
        },
        "dependencies": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Other task_ids that must complete first"
        },
        "inputs": {
          "type": "object",
          "description": "Pattern-specific input parameters"
        },
        "timeout_seconds": {
          "type": "integer",
          "minimum": 1,
          "default": 1800,
          "description": "Task execution timeout"
        },
        "metadata": {
          "type": "object",
          "description": "Additional task metadata"
        }
      }
    },
    
    "workspace_ref": {
      "type": "object",
      "required": ["ws_id", "root_path", "branch_name"],
      "properties": {
        "ws_id": {
          "type": "string",
          "description": "Workspace identifier"
        },
        "root_path": {
          "type": "string",
          "description": "Absolute path to workspace root"
        },
        "branch_name": {
          "type": "string",
          "description": "Git branch name"
        },
        "commit_sha": {
          "oneOf": [
            {"type": "null"},
            {"type": "string", "pattern": "^[0-9a-f]{40}$"}
          ],
          "description": "HEAD commit SHA"
        },
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 UTC timestamp"
        }
      }
    }
  }
}
